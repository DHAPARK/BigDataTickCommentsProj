<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

</head>
<body>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/highcharts-more.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/accessibility.js"></script>

	<figure class="highcharts-figure">
		<div id="container"></div>
	</figure>



	<%-- <c:set var="chartList" value="${requestScope.chartList }" />
	<div>
			글 개수 : ${chartList} 개
	</div> --%>

	<script>
		let word = new Array();
		let size = new Array();
		// window.onload : HTML이 다 load가 완료 됬을때 실행
		window.onload = function() {
			let obj = "";
			let xhr = new XMLHttpRequest();
			xhr.open("GET", "data3.json", true);
			xhr.send();
			xhr.onreadystatechange = function() {
				if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
					obj = JSON.parse(xhr.responseText);
					/*
						파싱된 obj에서 search_word라는 key를 가지고 있는 것을 꺼내보면
						[{},{},{},{}가 나온다. (배열 return)]
					 */
					for (let i = 0; i < obj.search_word.length; i++) {
						/*
							obj.serch_word 배열의 각 방에는 json들이 담겨있다.
							({"rank" : 순위, "name" : 검색어})
							각 방의 json들에서 name키로 담겨있는 검색어를 꺼내서 word 배열의 각 방에 넣는다.
						 */
						word[i] = obj.search_word[i].value;
						
						
			
		 	let obj2 = "";
			let xhr2 = new XMLHttpRequest();
			xhr2.open("GET", "data3.json", true);
			xhr2.send();
			xhr2.onreadystatechange = function() {
				if (xhr2.readyState == XMLHttpRequest.DONE && xhr2.status == 200) {
					obj2 = JSON.parse(xhr2.responseText);
					for (let i = 0; i < obj2.search_word.length; i++) {
						size[i] = obj2.search_word[i].size;    
					
					
						

						
		var chart = Highcharts.chart('container', {
		  chart: {
		    type: 'packedbubble',
		    height: '50%'
		  },
		  title: {
		    text: 'Comments by age'
		  },
		  tooltip: {
		    useHTML: true,
		    pointFormat: '<b>{point.name}:</b> {point.value}명 CO<sub>2</sub>'
		  },
		  plotOptions: {
		    packedbubble: {
		      minSize: '10%',
		      maxSize: '50%',
		      zMin: 0,
		      zMax: 1000,
		      layoutAlgorithm: {
		        gravitationalConstant: 0.05,
		        splitSeries: true,
		        seriesInteraction: false,
		        dragBetweenSeries: true,
		        parentNodeLimit: true
		      },
		      dataLabels: {
		        enabled: true,
		        format: '{point.name}',
		        filter: {
		          property: 'y',
		          operator: '>',
		          value: 150
		        },
		        style: {
		          color: 'black',
		          textOutline: 'none',
		          fontWeight: 'normal'
		        }
		      }
		    }
		  },
		  series: [ {
		    name: '10대',
		    data: [ {
		      name: word[0],
		      value: size[0]
		    },
		    {
		        name: word[1],
		        value: size[1]
		      },
		    {
		        name: word[2],
		        value: size[2]
		      },
		    {
		        name: word[3],
		        value: size[3]
		      },
		      {
		          name: word[4],
		          value: size[4]
		        }
		    ]
		  }]
		});
						//
						
						
					}}}}}}}	 
					
					
				
			
		
	 	  
	 	  

	
  
</script>









</body>
</html>